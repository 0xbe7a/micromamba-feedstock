commit 7334cbe4d4403c584f357ee6cdde622a041fddef
Author: Isuru Fernando <isuruf@gmail.com>
Date:   Sun Oct 30 23:19:59 2022 -0500

    Link micromamba with static libc++.a and system libc++abi

diff --git a/libmamba/CMakeLists.txt b/libmamba/CMakeLists.txt
index 6103bf9..6da16f5 100644
--- a/libmamba/CMakeLists.txt
+++ b/libmamba/CMakeLists.txt
@@ -300,6 +300,10 @@ macro(libmamba_create_target target_name linkage deps_linkage output_name)
                 libreproc++.a
                 libreproc.a
             )
+            if (APPLE)
+                set(REQUIRED_STATIC_DEPS ${REQUIRED_STATIC_DEPS} libc++.a)
+            endif()
+
 
             set(STATIC_DEPS "")
             foreach(LIB ${REQUIRED_STATIC_DEPS})
@@ -323,7 +327,7 @@ macro(libmamba_create_target target_name linkage deps_linkage output_name)
             endforeach(LIB)
 
             if (APPLE)
-                set (MAMBA_FORCE_DYNAMIC_LIBS resolv)
+                set (MAMBA_FORCE_DYNAMIC_LIBS resolv c++abi)
                 target_link_options(libmamba-full-static PRIVATE -static-libstdc++)
             elseif (UNIX)
                 set(MAMBA_FORCE_DYNAMIC_LIBS rt dl resolv)
diff --git a/micromamba/CMakeLists.txt b/micromamba/CMakeLists.txt
index f8c69bb..a9b83ac 100644
--- a/micromamba/CMakeLists.txt
+++ b/micromamba/CMakeLists.txt
@@ -81,6 +81,9 @@ if (${MICROMAMBA_LINKAGE} STREQUAL "FULL_STATIC")
     target_link_libraries(micromamba PRIVATE libmamba-full-static)
     if (WIN32)
         set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} /MT")
+    elseif (APPLE)
+        # link with C compiler so that shared libc++ is not linked in
+        set_target_properties(micromamba PROPERTIES LINKER_LANGUAGE C)
     endif ()
 elseif (${MICROMAMBA_LINKAGE} STREQUAL "STATIC")
     target_link_libraries(micromamba PRIVATE libmamba-static)
